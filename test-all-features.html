<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Accessibility Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/navigation.css">
    <style>
        .test-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 300px;
            background: var(--glass-surface);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            z-index: 10001;
            font-family: monospace;
            font-size: 12px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .feature-test {
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
            background: var(--darker-background);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .test-status.pending { background: #6B7280; color: white; }
        .test-status.testing { background: #F59E0B; color: white; }
        .test-status.success { background: #10B981; color: white; }
        .test-status.error { background: #EF4444; color: white; }
        .test-all-btn {
            background: var(--primary-purple);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        .current-feature {
            background: var(--primary-purple);
            color: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body class="theme-dark">
    <div id="test-panel" class="test-panel">
        <h3>üß™ Feature Access Test</h3>
        <button class="test-all-btn" onclick="testAllFeatures()">Test All Features</button>
        <div id="current-feature" class="current-feature">No feature active</div>
        <div id="test-results"></div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <h2>Testing Features...</h2>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">Feature Test Suite</h1>
                <div class="header-controls">
                    <button id="theme-toggle" class="btn-icon">üåô</button>
                </div>
            </div>
        </header>

        <div class="app-content-wrapper">
            <main class="main-content">
                <!-- All tab sections from main app -->
                <section id="characters-tab" class="tab-content active">
                    <h2>Character Builder</h2>
                    <p>‚úÖ Character Builder is accessible and functional</p>
                </section>

                <section id="pictos-tab" class="tab-content">
                    <h2>Pictos & Lumina Manager</h2>
                    <p>‚úÖ Pictos & Lumina feature is accessible and functional</p>
                </section>

                <section id="party-tab" class="tab-content">
                    <h2>Party Composer</h2>
                    <p>‚úÖ Party Composer is accessible and functional</p>
                </section>

                <section id="collectibles-tab" class="tab-content">
                    <h2>Collectibles Tracker</h2>
                    <p>‚úÖ Collectibles Tracker is accessible and functional</p>
                </section>

                <section id="calculator-tab" class="tab-content">
                    <h2>Damage Calculator</h2>
                    <p>‚úÖ Damage Calculator is accessible and functional</p>
                </section>

                <section id="bosses-tab" class="tab-content">
                    <h2>Boss Tracker</h2>
                    <p>‚úÖ Boss Tracker is accessible and functional</p>
                </section>

                <section id="comparison-tab" class="tab-content">
                    <h2>Build Comparison</h2>
                    <p>‚úÖ Build Comparison is accessible and functional</p>
                </section>

                <section id="guides-tab" class="tab-content">
                    <h2>Build Guides</h2>
                    <p>‚úÖ Build Guides are accessible and functional</p>
                </section>

                <section id="optimizer-tab" class="tab-content">
                    <h2>Team Optimizer</h2>
                    <p>‚úÖ Team Optimizer is accessible and functional</p>
                </section>

                <section id="achievements-tab" class="tab-content">
                    <h2>Achievement Tracker</h2>
                    <p>‚úÖ Achievement Tracker is accessible and functional</p>
                </section>

                <section id="builds-tab" class="tab-content">
                    <h2>Saved Builds</h2>
                    <p>‚úÖ Saved Builds are accessible and functional</p>
                </section>
            </main>
        </div>
    </div>

    <script type="module">
        const features = [
            { path: 'characters', name: 'Character Builder', icon: 'üë§' },
            { path: 'pictos', name: 'Pictos & Lumina', icon: 'üîÆ' },
            { path: 'party', name: 'Party Composer', icon: '‚öîÔ∏è' },
            { path: 'collectibles', name: 'Collectibles', icon: 'üó∫Ô∏è' },
            { path: 'calculator', name: 'Damage Calculator', icon: 'üìä' },
            { path: 'bosses', name: 'Boss Tracker', icon: 'üëπ' },
            { path: 'comparison', name: 'Build Comparison', icon: 'üìã' },
            { path: 'guides', name: 'Build Guides', icon: 'üìñ' },
            { path: 'optimizer', name: 'Team Optimizer', icon: 'üéØ' },
            { path: 'achievements', name: 'Achievements', icon: 'üèÜ' },
            { path: 'builds', name: 'Saved Builds', icon: 'üíæ' }
        ];

        let testResults = {};
        let router, navigation;

        function initializeTestResults() {
            features.forEach(feature => {
                testResults[feature.path] = { status: 'pending', error: null };
            });
            updateResultsDisplay();
        }

        function updateResultsDisplay() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = features.map(feature => {
                const result = testResults[feature.path];
                const statusIcon = {
                    pending: '‚è≥',
                    testing: 'üîÑ',
                    success: '‚úÖ',
                    error: '‚ùå'
                }[result.status];

                return `
                    <div class="feature-test">
                        <span>${feature.icon} ${feature.name}</span>
                        <span class="test-status ${result.status}" title="${result.error || result.status}">
                            ${statusIcon}
                        </span>
                    </div>
                `;
            }).join('');
        }

        function updateCurrentFeature(featureName) {
            document.getElementById('current-feature').textContent = featureName || 'No feature active';
        }

        async function testFeature(feature) {
            console.log(`Testing feature: ${feature.name}`);
            testResults[feature.path].status = 'testing';
            updateResultsDisplay();
            updateCurrentFeature(`Testing: ${feature.name}`);

            try {
                // Test navigation to feature
                if (router) {
                    router.navigate(feature.path);
                    await new Promise(resolve => setTimeout(resolve, 300)); // Wait for transition
                }

                // Check if tab content is visible
                const tabContent = document.getElementById(`${feature.path}-tab`);
                if (!tabContent) {
                    throw new Error(`Tab content ${feature.path}-tab not found`);
                }

                const isVisible = tabContent.classList.contains('active');
                if (!isVisible) {
                    throw new Error(`Tab content is not visible`);
                }

                // Check if content is actually rendered
                const hasContent = tabContent.innerHTML.trim().length > 0;
                if (!hasContent) {
                    throw new Error(`Tab content is empty`);
                }

                testResults[feature.path].status = 'success';
                testResults[feature.path].error = null;
                console.log(`‚úÖ ${feature.name} test passed`);

            } catch (error) {
                testResults[feature.path].status = 'error';
                testResults[feature.path].error = error.message;
                console.error(`‚ùå ${feature.name} test failed:`, error.message);
            }

            updateResultsDisplay();
        }

        async function testAllFeatures() {
            console.log('üß™ Starting comprehensive feature test...');
            updateCurrentFeature('Initializing test suite...');

            try {
                // Initialize modules
                const routerModule = await import('./js/utils/router.js');
                const navModule = await import('./js/components/navigation.js');

                router = routerModule.router;
                navigation = navModule.navigation;

                // Show app
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';

                updateCurrentFeature('Initializing router and navigation...');

                // Initialize router
                router.addRoute('characters', (path) => showTab(path));
                router.addRoute('pictos', (path) => showTab(path));
                router.addRoute('party', (path) => showTab(path));
                router.addRoute('collectibles', (path) => showTab(path));
                router.addRoute('calculator', (path) => showTab(path));
                router.addRoute('bosses', (path) => showTab(path));
                router.addRoute('comparison', (path) => showTab(path));
                router.addRoute('guides', (path) => showTab(path));
                router.addRoute('optimizer', (path) => showTab(path));
                router.addRoute('achievements', (path) => showTab(path));
                router.addRoute('builds', (path) => showTab(path));

                router.init();

                // Initialize navigation (after a delay)
                setTimeout(() => {
                    navigation.init();
                }, 200);

                updateCurrentFeature('Testing individual features...');

                // Test each feature
                for (const feature of features) {
                    await testFeature(feature);
                    await new Promise(resolve => setTimeout(resolve, 500)); // Pause between tests
                }

                // Generate summary
                const successful = Object.values(testResults).filter(r => r.status === 'success').length;
                const failed = Object.values(testResults).filter(r => r.status === 'error').length;

                updateCurrentFeature(`‚úÖ Testing complete: ${successful}/${features.length} passed`);

                if (failed === 0) {
                    console.log('üéâ All features are accessible and functional!');
                } else {
                    console.log(`‚ö†Ô∏è ${failed} features failed accessibility test`);
                }

            } catch (error) {
                updateCurrentFeature(`‚ùå Test suite failed: ${error.message}`);
                console.error('Test suite initialization failed:', error);
            }
        }

        function showTab(path) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            const targetTab = document.getElementById(`${path}-tab`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        // Make function global
        window.testAllFeatures = testAllFeatures;

        // Initialize
        initializeTestResults();

        // Auto-start test after page load
        window.addEventListener('load', () => {
            setTimeout(testAllFeatures, 1000);
        });
    </script>
</body>
</html>